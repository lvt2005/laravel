<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="../../img/favicon.ico" />
    <title>Đội ngũ bác sĩ - Bệnh viện Đa khoa Quốc tế Nam Sài Gòn</title>
    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .doctors {
            padding: 60px 0;
        }

        .section-title {
            font-size: 32px;
            margin-bottom: 40px;
            text-align: center;
            color: #2c3e50;
            font-weight: 700;
        }

        .doctor-cards {
            display: flex;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .doctor-cards .doctor-card {
            flex: 1 0 calc(25% - 15px);
        }

        .doctor-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .doctor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }

        .img-wrap {
            position: relative;
            width: 100%;
            height: 200px;
            overflow: hidden;
            background: linear-gradient(135deg, #e0e0e0, #f5f5f5);
        }

        .img-wrap::after {
            content: 'Xem chi tiết';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .doctor-card:hover .img-wrap::after {
            opacity: 1;
        }

        .doctor-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .doctor-info {
            padding: 15px;
        }

        .doctor-info h3 {
            font-size: 16px;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
        }

        .doctor-info p {
            font-size: 12px;
            color: #666;
            margin: 0;
            line-height: 1.4;
        }

        .doctor-specialty {
            color: #3498db !important;
            font-weight: 500;
            margin-bottom: 4px !important;
        }

        .doctor-experience {
            color: #888 !important;
            margin-bottom: 6px !important;
        }

        .doctor-desc {
            color: #555 !important;
            font-style: italic;
            min-height: 32px;
        }

        .doctor-rating {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            margin-top: 8px;
            color: #f4c430;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 50px;
            padding: 20px 0;
        }

        .pagination-btn {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(53,122,189,0.2);
        }

        .pagination-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #357abd 0%, #2a5f94 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(53,122,189,0.3);
        }

        .pagination-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            opacity: 0.6;
            box-shadow: none;
        }

        .page-info {
            font-size: 16px;
            font-weight: 500;
            color: #333;
            padding: 0 10px;
            min-width: 120px;
            text-align: center;
        }

        .page-info .current-page {
            font-weight: 700;
            color: #4a90e2;
            font-size: 18px;
        }

        @media (max-width: 992px) {
            .doctor-cards .doctor-card {
                flex: 1 0 calc(50% - 10px);
            }
        }

        @media (max-width: 768px) {
            .doctor-cards {
                flex-direction: column;
            }

            .doctor-cards .doctor-card {
                flex: 1 0 100%;
            }

            .section-title {
                font-size: 24px;
            }

            .pagination {
                flex-direction: column;
                gap: 15px;
            }

            .pagination-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
<section class="doctors" id="doctors">
    <div class="container">
        <h2 class="section-title">Đội ngũ bác sĩ chất lượng cao</h2>
        <div class="doctor-cards" id="doctorCards">
            <!-- Doctor cards will be rendered here by JavaScript -->
        </div>
        <div class="pagination">
            <button class="pagination-btn" id="prevBtn" onclick="changePage(-1)">
                <span>←</span> Trang trước
            </button>
            <div class="page-info">
                <span>Trang <span class="current-page" id="currentPage">1</span> / <span id="totalPages">1</span></span>
            </div>
            <button class="pagination-btn" id="nextBtn" onclick="changePage(1)">
                Trang sau <span>→</span>
            </button>
        </div>
    </div>
</section>

<script>
    // API Base URL
    const API_BASE = (location.port === '8000' ? '/api' : 'http://127.0.0.1:8000/api');
    
    // State
    let allDoctors = [];
    let currentPage = 1;
    let totalPages = 1;
    const DOCTORS_PER_PAGE = 4;
    let isLoading = false;

    // Fetch doctors từ API
    async function fetchDoctors(page = 1) {
        if (isLoading) return;
        isLoading = true;
        
        const container = document.getElementById('doctorCards');
        container.innerHTML = '<div style="text-align:center;padding:40px;color:#666;"><i class="fas fa-spinner fa-spin" style="font-size:24px;margin-bottom:10px;display:block;"></i>Đang tải danh sách bác sĩ...</div>';
        
        try {
            const response = await fetch(`${API_BASE}/public/doctors?page=${page}&per_page=${DOCTORS_PER_PAGE}`);
            const data = await response.json();
            
            if (data.data && data.data.length > 0) {
                allDoctors = data.data;
                currentPage = data.pagination.current_page;
                totalPages = data.pagination.last_page;
                renderDoctors();
            } else {
                container.innerHTML = '<div style="text-align:center;padding:40px;color:#666;"><i class="fas fa-user-md" style="font-size:40px;margin-bottom:15px;display:block;color:#ccc;"></i>Hiện chưa có bác sĩ nào trong hệ thống</div>';
                updatePagination();
            }
        } catch (error) {
            console.error('Error fetching doctors:', error);
            container.innerHTML = '<div style="text-align:center;padding:40px;color:#e74c3c;"><i class="fas fa-exclamation-circle" style="font-size:40px;margin-bottom:15px;display:block;"></i>Không thể tải danh sách bác sĩ. Vui lòng thử lại sau.</div>';
        } finally {
            isLoading = false;
        }
    }

    function renderDoctors() {
        const container = document.getElementById('doctorCards');
        
        if (allDoctors.length === 0) {
            container.innerHTML = '<div style="text-align:center;padding:40px;color:#666;">Không có bác sĩ nào</div>';
            return;
        }

        container.innerHTML = allDoctors.map(doctor => {
            const avatarUrl = doctor.avatar_url || '/frontend/img/default-doctor.png';
            const specialization = doctor.specialization?.name || 'Đa khoa';
            const experience = doctor.experience || 0;
            const degree = doctor.degree || '';
            const displayName = degree ? `${degree} ${doctor.full_name}` : doctor.full_name;
            const description = doctor.description || '';
            const shortDesc = description.length > 50 ? description.substring(0, 50) + '...' : description;
            const rating = doctor.rating_avg || 0;
            
            // Render stars
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 >= 0.5 ? 1 : 0;
            const emptyStars = 5 - fullStars - halfStar;
            let starsHtml = '';
            for (let i = 0; i < fullStars; i++) starsHtml += '<i class="fas fa-star"></i>';
            if (halfStar) starsHtml += '<i class="fas fa-star-half-alt"></i>';
            for (let i = 0; i < emptyStars; i++) starsHtml += '<i class="far fa-star"></i>';
            
            return `
                <div class="doctor-card" data-id="${doctor.id}" onclick="viewDoctorDetail(${doctor.id})">
                    <div class="img-wrap">
                        <img class="doctor-img" alt="${doctor.full_name}" 
                             src="${avatarUrl}" 
                             onerror="this.src='/frontend/img/default-doctor.png'" />
                    </div>
                    <div class="doctor-info">
                        <h3>${displayName}</h3>
                        <p class="doctor-specialty">${specialization}</p>
                        <p class="doctor-experience">${experience} năm kinh nghiệm</p>
                        <p class="doctor-desc">${shortDesc || 'Bác sĩ chuyên khoa'}</p>
                        <div class="doctor-rating">
                            ${starsHtml}
                            <span style="color:#666;font-size:12px;margin-left:5px;">(${rating.toFixed(1)})</span>
                        </div>
                    </div>
                </div>
            `;
        }).join('');

        updatePagination();
    }

    function updatePagination() {
        document.getElementById('currentPage').textContent = currentPage;
        document.getElementById('totalPages').textContent = totalPages;
        document.getElementById('prevBtn').disabled = currentPage === 1;
        document.getElementById('nextBtn').disabled = currentPage === totalPages;
    }

    function changePage(direction) {
        const newPage = currentPage + direction;
        if (newPage >= 1 && newPage <= totalPages) {
            fetchDoctors(newPage);
            document.getElementById('doctors').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }

    function viewDoctorDetail(doctorId) {
        window.location.href = `/frontend/pages/funtion/doctor_detail.html?id=${doctorId}`;
    }

    // Khởi tạo khi trang load
    document.addEventListener('DOMContentLoaded', () => {
        fetchDoctors(1);
    });
</script>
</body>
</html>
