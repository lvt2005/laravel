<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="../../img/favicon.ico" />
    <title>Header</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/boxicons/2.1.4/boxicons.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            line-height: 1.6;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Menu styles */
        .header-wrap {
            background-color: #ffffff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            width: 100%;
            margin: 0;
            padding: 0;
        }

        .header-nav {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 80px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 280px;
            margin-right: 30px;
        }

        .logo-img {
            width: 280px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
        }

        .logo-text h1 {
            font-size: 16px;
            color: #333;
            font-weight: 600;
            line-height: 1.2;
        }

        .logo-text h1 small {
            display: block;
            font-size: 13px;
            color: #666;
            font-weight: 400;
        }

        .search-box {
            flex: 0 0 200px;
            margin-right: 30px;
        }

        .search-box input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 13px;
            color: #999;
            background-color: #f9f9f9;
        }

        .search-box input::placeholder {
            color: #bbb;
        }

        .menu-list {
            display: flex;
            align-items: center;
            list-style: none;
            flex: 1;
            gap: 0;
            margin: 0;
        }

        .menu-item {
            position: relative;
        }

        .menu-item>a {
            display: flex;
            align-items: center;
            padding: 25px 15px;
            color: #333;
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            transition: color 0.3s ease;
        }

        .menu-item>a:hover {
            color: #3498db;
        }

        .menu-item.menu-item-has-children>a {
            display: flex;
            gap: 5px;
        }

        .menu-item i {
            font-size: 14px;
            transition: transform 0.3s ease;
        }

        .menu-item.menu-dropdown:hover>i {
            transform: rotate(180deg);
        }

        /* Dropdown Menu */
        .child {
            position: absolute;
            top: 100%;
            left: 0;
            background-color: #ffffff;
            list-style: none;
            min-width: 200px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-radius: 4px;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .menu-item.menu-dropdown:hover .child {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .child li {
            list-style: none;
        }

        .child li a {
            display: block;
            padding: 12px 20px;
            color: #666;
            text-decoration: none;
            font-size: 13px;
            transition: all 0.3s ease;
            white-space: normal;
        }

        .child li a:hover {
            background-color: #f0f8ff;
            color: #3498db;
            padding-left: 25px;
        }

        /* Mega Menu */
        .menu-mega {
            position: absolute;
            top: 100%;
            left: 0;
            background-color: #ffffff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-radius: 4px;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 100;
            display: flex;
            min-width: 600px;
        }

        .menu-mega ul {
            flex: 1;
            list-style: none;
            padding: 15px 0;
            border-right: 1px solid #f0f0f0;
        }

        .menu-mega ul:last-child {
            border-right: none;
        }

        .menu-mega li {
            list-style: none;
        }

        .menu-mega .menu-link {
            display: block;
            padding: 10px 20px;
            color: #666;
            text-decoration: none;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .menu-mega .menu-link:hover {
            background-color: #f0f8ff;
            color: #3498db;
            padding-left: 25px;
        }

        .menu-chuyen-khoa:hover .menu-mega {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        /* Right Section */
        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-left: auto;
            position: relative;
        }

        .language-selector {
            background-color: transparent;
            border: none;
            color: #333;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            padding: 8px 10px;
            transition: color 0.3s ease;
        }

        .language-selector:hover {
            color: #3498db;
        }

        .btn-register {
            background-color: #f4c430;
            color: #fff;
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            text-decoration: none;
            display: inline-block;
        }

        .btn-register:hover {
            background-color: #e8b81a;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(244, 196, 48, 0.3);
        }

        /* User Menu Styles */
        .user-menu {
            position: relative;
            display: none;
            /* Hidden by default */
        }

        .user-menu.active {
            display: block;
        }

        .user-button {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: #f0f8ff;
            color: #3498db;
            border: 2px solid #3498db;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .user-button:hover {
            background-color: #3498db;
            color: #fff;
        }

        .user-button i {
            font-size: 18px;
        }

        .user-dropdown {
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            background-color: #ffffff;
            min-width: 200px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-radius: 8px;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .user-menu:hover .user-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .user-dropdown-header {
            padding: 15px 20px;
            background-color: #f0f8ff;
            border-bottom: 1px solid #e0e0e0;
        }

        .user-dropdown-header .user-name {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 3px;
        }

        .user-dropdown-header .user-role {
            font-size: 12px;
            color: #666;
        }

        .user-dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            color: #666;
            text-decoration: none;
            font-size: 13px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .user-dropdown-item:hover {
            background-color: #f0f8ff;
            color: #3498db;
            padding-left: 25px;
        }

        .user-dropdown-item i {
            font-size: 16px;
        }

        .user-dropdown-divider {
            height: 1px;
            background-color: #e0e0e0;
            margin: 5px 0;
        }

        .user-dropdown-item.logout {
            color: #e74c3c;
        }

        .user-dropdown-item.logout:hover {
            background-color: #ffebee;
            color: #c0392b;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .menu-list {
                gap: 0;
            }

            .menu-item>a {
                padding: 20px 12px;
                font-size: 12px;
            }
        }

        @media (max-width: 768px) {
            .header-nav {
                height: auto;
                padding: 15px 20px;
                flex-wrap: wrap;
            }

            .menu-list {
                flex-direction: column;
                width: 100%;
                margin-top: 15px;
            }

            .child {
                position: static;
                opacity: 1;
                visibility: visible;
                transform: none;
                display: none;
                box-shadow: none;
                background-color: #f9f9f9;
            }

            .menu-item.menu-dropdown:hover .child {
                display: block;
            }

            .user-dropdown {
                right: auto;
                left: 0;
            }
        }
    </style>
</head>

<body>
<div class="header-wrap">
    <nav class="header-nav">
        <!-- Logo Section -->
        <div class="logo-section">
            <a href="/" title="Về trang chủ">
                <img src="/frontend/img/logomau.jpg" alt="Logo" class="logo-img">
            </a>
        </div>

        <!-- Search Box -->
        <div class="search-box">
            <input type="text" placeholder="Tìm kiếm bác sĩ/chuyên khoa">
        </div>
        <!-- Main Menu -->
        <ul id="menu-menu-main" class="menu-list">
            <!-- Đội Ngũ Bác Sĩ -->
            <li class="menu-item menu-item-type-custom menu-item-object-custom">
                <a class="menu-link" href="/tim-bac-si" title="Đội Ngũ Bác Sĩ">Đội Ngũ Bác Sĩ</a>
            </li>

            <!-- Chuyên Khoa -->
            <li
                class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-chuyen-khoa">
                <a class="menu-link" href="#" title="Chuyên Khoa">Chuyên Khoa</a>
                <i class="bx bxs-chevron-down"></i>
                <div class="menu-mega">
                    <ul>
                        <li class="menu-item">
                            <a class="menu-link" href="/chuyen-khoa">Khoa Khám Bệnh</a>
                        </li>
                        <li><a class="menu-link" href="/chuyen-khoa/ngoai-than-kinh">Phòng Khám Ngoại Thần
                            Kinh</a></li>
                        <li><a class="menu-link" href="/chuyen-khoa/chan-thuong-chinh-hinh">Phòng Khám Chấn
                            thương Chỉnh Hình, Cơ-Xương-Khớp</a></li>
                        <li><a class="menu-link" href="/chuyen-khoa/ngoai-tong-hop">Phòng Ngoại Tổng Hợp</a>
                        </li>
                        <li><a class="menu-link" href="/chuyen-khoa/noi-tong-hop">Phòng Nội Tổng Hợp</a>
                        </li>
                        <li><a class="menu-link" href="/chuyen-khoa/tai-mui-hong">Phòng Khám Tai - Mũi -
                            Họng</a></li>
                    </ul>
                    <ul>
                        <li><a class="menu-link" href="/chuyen-khoa/vat-ly-tri-lieu">Khoa Vật Lý Trị Liệu -
                            Phục Hồi Chức Năng</a></li>
                        <li><a class="menu-link" href="/chuyen-khoa/gay-me">Khoa Gây mê - Hồi
                            Sức</a></li>
                        <li><a class="menu-link" href="/chuyen-khoa/hoi-suc-tich-cuc">Khoa Hồi Sức Tích Cực -
                            Cấp Cứu</a></li>
                        <li><a class="menu-link" href="/chuyen-khoa/xet-nghiem">Khoa Xét Nghiệm</a></li>
                        <li><a class="menu-link" href="/chuyen-khoa/chan-doan-hinh-anh">Khoa Chẩn đoán Hình
                            ảnh - Thăm Dò Chức Năng</a></li>
                        <li><a class="menu-link" href="/chuyen-khoa/duoc">Khoa Dược</a></li>
                    </ul>
                </div>
            </li>

            <!-- Dịch Vụ -->
            <li
                class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-dropdown">
                <a class="menu-link" href="#" title="Dịch Vụ">Dịch Vụ</a>
                <i class="bx bxs-chevron-down"></i>
                <ul class="child">
                    <li><a class="menu-link" href="/dich-vu/tam-soat-ung-thu">Tầm Soát Ung Thư</a></li>
                    <li><a class="menu-link" href="/dich-vu/noi-soi">Dịch Vụ Nội Soi</a></li>
                    <li><a class="menu-link" href="/dich-vu/kham-suc-khoe-dinh-ky">Khám Sức Khỏe Định Kỳ</a>
                    </li>
                </ul>
            </li>

            <!-- Hướng Dẫn Khách Hàng -->
            <li
                class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-dropdown">
                <a class="menu-link" href="#" title="Hướng Dẫn Khách Hàng">Hướng Dẫn Khách Hàng</a>
                <i class="bx bxs-chevron-down"></i>
                <ul class="child">
                    <li><a class="menu-link" href="#">Bảng Giá Tiền Giường</a></li>
                    <li><a class="menu-link" href="#">Bảo Hiểm</a></li>
                    <li><a class="menu-link" href="#">Quyền và Nghĩa Vụ Của Người Bệnh</a></li>
                </ul>
            </li>

            <!-- Liên Hệ -->
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
                <a class="menu-link" href="#" title="Liên Hệ">Liên Hệ</a>
            </li>
        </ul>

        <!-- Right Section -->
        <div class="header-right">
            <!-- Login Button (shown when not logged in) -->
            <a href="/dang-nhap" class="btn-register" id="loginBtn">Đăng Nhập</a>

            <!-- User Menu (shown when logged in) -->
            <div class="user-menu" id="userMenu">
                <button class="user-button">
                    <i class='bx bxs-user-circle'></i>
                    <img id="userAvatar" src="" alt="Avatar" style="display:none; width:32px; height:32px; border-radius:50%; object-fit:cover;">
                    <span id="userName">Người dùng</span>
                </button>
                <div class="user-dropdown">
                    <div class="user-dropdown-header">
                        <div class="user-name" id="userNameFull">Người dùng</div>
                        <div class="user-role" id="userRole">Bệnh nhân</div>
                    </div>
                    <a href="/ho-so" class="user-dropdown-item" id="profileLink">
                        <i class='bx bxs-user'></i>
                        <span>Trang cá nhân</span>
                    </a>
                    <div class="user-dropdown-divider"></div>
                    <a href="#" class="user-dropdown-item logout" id="logoutBtn">
                        <i class='bx bx-log-out'></i>
                        <span>Đăng xuất</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>
</div>

<script src="/frontend/js/auth.js"></script>
<script>
    // Check login status from localStorage/sessionStorage
    async function checkLoginStatus() {
        const accessToken = localStorage.getItem('access_token') || sessionStorage.getItem('access_token');
        
        const loginBtn = document.getElementById('loginBtn');
        const userMenu = document.getElementById('userMenu');
        const userNameEl = document.getElementById('userName');
        const userNameFullEl = document.getElementById('userNameFull');
        const userAvatarEl = document.getElementById('userAvatar');
        const userRoleEl = document.getElementById('userRole');

        if (accessToken) {
            try {
                // Fetch user profile from API
                const profile = await AuthAPI.getProfile();
                
                if (profile && profile.id) {
                    // User is logged in - show user menu
                    loginBtn.style.display = 'none';
                    userMenu.classList.add('active');
                    
                    // Update user info
                    const displayName = profile.full_name || profile.email.split('@')[0];
                    userNameEl.textContent = displayName;
                    userNameFullEl.textContent = displayName;
                    
                    // Update avatar
                    if (profile.avatar_url) {
                        userAvatarEl.src = profile.avatar_url;
                        userAvatarEl.style.display = 'block';
                        document.querySelector('.user-button i').style.display = 'none';
                    }
                    
                    // Update role
                    const roleMap = {
                        'USER': 'Bệnh nhân',
                        'DOCTOR': 'Bác sĩ',
                        'ADMIN': 'Quản trị viên'
                    };
                    userRoleEl.textContent = roleMap[profile.type] || 'Người dùng';
                    
                    // Store for later use
                    localStorage.setItem('user_profile', JSON.stringify(profile));
                } else {
                    showLoginButton();
                }
            } catch (e) {
                console.error('Error fetching profile:', e);
                showLoginButton();
            }
        } else {
            showLoginButton();
        }
    }

    function showLoginButton() {
        const loginBtn = document.getElementById('loginBtn');
        const userMenu = document.getElementById('userMenu');
        loginBtn.style.display = 'inline-block';
        userMenu.classList.remove('active');
    }

    // Logout function
    document.getElementById('logoutBtn').addEventListener('click', async function (e) {
        e.preventDefault();
        if (confirm('Bạn có chắc chắn muốn đăng xuất?')) {
            try {
                await AuthAPI.logout();
            } catch (e) {
                console.error('Logout error:', e);
            }
            // Clear all storage
            localStorage.removeItem('access_token');
            localStorage.removeItem('refresh_token');
            localStorage.removeItem('session_id');
            localStorage.removeItem('user_profile');
            sessionStorage.removeItem('access_token');
            sessionStorage.removeItem('refresh_token');
            sessionStorage.removeItem('session_id');
            
            // Redirect to login
            window.location.href = '/dang-nhap';
        }
    });

    // Navigate to profile
    document.getElementById('profileLink')?.addEventListener('click', function(e) {
        e.preventDefault();
        window.location.href = '/ho-so';
    });

    // Check login status when page loads
    document.addEventListener('DOMContentLoaded', function () {
        checkLoginStatus();
    });
</script>
</body>

</html>
